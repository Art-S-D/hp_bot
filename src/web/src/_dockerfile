FROM node:12.16.2-alpine3.9

WORKDIR /usr/app

RUN apk add git

COPY package.json .
COPY src/web/src ./src/web/src
COPY src/web/public ./src/web/public
COPY src/web/package.json ./src/web/package.json
COPY src/web/webpack.config.js src/web/webpack.config.js
COPY src/mongo ./src/mongo
RUN yarn install
RUN yarn workspace web build

EXPOSE 3000
ENV PORT=3000

ENV MONGO_URL="mongodb://host.docker.internal:27017/dev"
ENV API_URL='host.docker.internal:8080'
# ENV WEBSITE_URL='host.docker.internal:3000'

CMD yarn workspace web serve -s build -l 3000