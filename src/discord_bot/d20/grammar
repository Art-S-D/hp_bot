{
  function makeInteger(o) {
    return parseInt(o.join(""), 10);
  }
}

d20 = "!d" optionalSpace
    bonus1:(optionalSpace "+" optionalSpace bonus1:value optionalSpace {return bonus1})?
    bonus2:(optionalSpace "+" optionalSpace bonus2:value optionalSpace {return bonus2})?
    reroll:(optionalSpace "/" optionalSpace reroll:value optionalSpace {return reroll})?
    optionalSpace
    {return {bonus1, bonus2, reroll}}

optionalSpace = " "* {return null;}
requiredSpace = " "+ {return null;}

value = res:(word / number) {return res;}
number = nb:[0-9]+ {return makeInteger(nb)}
word= w:([a-zA-Z]+) {return w.join("")}